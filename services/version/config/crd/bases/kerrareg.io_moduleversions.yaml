---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: moduleversions.kerrareg.io
spec:
  group: kerrareg.io
  names:
    kind: ModuleVersion
    listKind: ModuleVersionList
    plural: moduleversions
    singular: moduleversion
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The auto generated file name for the module version
      jsonPath: .spec.fileName
      name: FileName
      type: string
    - description: The checksum of the module version
      jsonPath: .spec.checksum
      name: Checksum
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ModuleVersion is the Schema for the ModuleVersion API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ModuleVersionSpec defines a specific version of a Kerrareg
              Module.
            properties:
              checksum:
                description: The SHA256 checksum of the module as a base64 encoded
                  string.
                type: string
              fileName:
                description: |-
                  The name of the module archive file with its extension.
                  The file extension must be one of .zip or .tar.gz
                  since terraform and tofu currently only support these two
                  extension types.
                type: string
              moduleConfig:
                description: The reference to the Module resource
                properties:
                  githubClientConfig:
                    description: The Github client configuration settings
                    properties:
                      useAuthenticatedClient:
                        description: |-
                          This flag determines whether the GitHub client used to download modules
                          will be authenticated with a Github App. It's highly recommended
                          to enable this flag to avoid GitHub API rate limiting. When enabled, the namespace where the module is deployed
                          must contain a Secret named 'kerrareg-github-application-secret'. The secret must contain a githubAppID,
                          githubInstallID, and githubPrivateKey. The private key must be base64 encoded before being added
                          as data to the secret. When accessed, the controller will base64 decode the key to build an in-memory client
                          to authenticate with the Github API.
                        type: boolean
                    required:
                    - useAuthenticatedClient
                    type: object
                  immutable:
                    description: |-
                      When true, enforces that the ChecksumSHA256 of the module archive
                      always matches the value stored in this field and in any destination storage config
                    type: boolean
                  name:
                    description: The name of the module
                    type: string
                  repoOwner:
                    description: Owner of the Github repository
                    type: string
                  storageConfig:
                    description: The external storage configuration settings
                    properties:
                      s3:
                        properties:
                          bucket:
                            type: string
                          key:
                            type: string
                          region:
                            type: string
                        required:
                        - bucket
                        - region
                        type: object
                    type: object
                required:
                - immutable
                - name
                - repoOwner
                type: object
              version:
                description: The version of the module
                type: string
            required:
            - moduleConfig
            - version
            type: object
          status:
            properties:
              syncStatus:
                type: string
              synced:
                type: boolean
            required:
            - syncStatus
            - synced
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
