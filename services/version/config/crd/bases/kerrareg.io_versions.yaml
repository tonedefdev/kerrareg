---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: versions.kerrareg.io
spec:
  group: kerrareg.io
  names:
    kind: Version
    listKind: VersionList
    plural: versions
    singular: version
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The type of resource. Either 'Module' or 'Provider'
      jsonPath: .spec.type
      name: Type
      type: string
    - description: The auto generated file name for the Version
      jsonPath: .spec.fileName
      name: FileName
      type: string
    - description: Whether the Version has synced successfully
      jsonPath: .status.synced
      name: Synced
      type: string
    - description: The base64 encoded SHA256 checksum of the file Version
      jsonPath: .status.checksum
      name: Checksum
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Version is the Schema for the Version API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: VersionSpec defines a specific version of a Kerrareg Module
              or Provider.
            properties:
              fileName:
                description: |-
                  The name of the file with its extension.
                  For a Module the file extension must be one of .zip or .tar.gz
                  since terraform/tofu currently only support these two
                  extension types.
                type: string
              forceSync:
                description: A flag to force a module version to synchronize.
                type: boolean
              moduleConfigRef:
                description: The reference to the Module resource's config.
                properties:
                  fileFormat:
                    description: |-
                      The file format of the module
                      This must be one of 'zip' or 'tar'.
                    type: string
                  githubClientConfig:
                    description: The Github client configuration settings.
                    properties:
                      useAuthenticatedClient:
                        description: |-
                          This flag determines whether the GitHub client used to download modules
                          will be authenticated with a Github App. It's highly recommended
                          to enable this flag to avoid GitHub API rate limiting. When enabled, the namespace where the Module resource exists
                          must contain a Secret named 'kerrareg-github-application-secret'. The secret must contain a githubAppID,
                          githubInstallID, and githubPrivateKey field. The private key must also be base64 encoded before being added
                          as data to the secret. When accessed, the controller will base64 decode the key to build an in-memory client
                          to authenticate with the Github API.
                        type: boolean
                    type: object
                  immutable:
                    description: |-
                      When true, enforces that the ChecksumSHA256 of the module archive
                      always matches the value stored in this field and in any destination storage config.
                    type: boolean
                  name:
                    description: |-
                      The name of the module. If omitted, the name of the Module resource
                      is used in its place.
                    type: string
                  provider:
                    description: The main terraform or tofu provider required for
                      this module.
                    type: string
                  repoOwner:
                    description: Owner of the Github repository.
                    type: string
                  repoUrl:
                    description: The full URL of the Github repository.
                    type: string
                  storageConfig:
                    description: The external storage configuration settings.
                    properties:
                      fileSystem:
                        description: The configuration settings for storing Versions
                          on a local filesystem.
                        properties:
                          directoryPath:
                            description: The directory path on the file system where
                              the Version will be stored.
                            type: string
                        type: object
                      s3:
                        description: The configuration settings for storing Versions
                          in an Amazon S3 bucket.
                        properties:
                          bucket:
                            description: The S3 bucket name.
                            type: string
                          key:
                            description: |-
                              The S3 bucket key, ie: 'my/bucket/prefix'
                              The file name will be automatically generated by the kerrareg-module-controller.
                            type: string
                          region:
                            description: The AWS region for the bucket.
                            type: string
                        required:
                        - bucket
                        - region
                        type: object
                    type: object
                  versionConstraints:
                    description: |-
                      A comma separated list of version constraints such as
                      '1.2.1' or '>= 1.0.0, < 2.0.0' or '~> 1.0.0, != 1.0.2'. This field is only
                      respected by the Depot controller.
                    type: string
                type: object
              providerConfigRef:
                description: The reference to the Provider resource's config.
                properties:
                  name:
                    description: The name of the provider.
                    type: string
                type: object
              type:
                description: The type of resource. Either 'Module' or 'Provider'
                type: string
              version:
                description: The version of the Module or Provider.
                type: string
            required:
            - type
            - version
            type: object
          status:
            description: VersionStatus defines the current status of the resource.
            properties:
              checksum:
                description: The SHA256 checksum of the module as a base64 encoded
                  string.
                type: string
              syncStatus:
                description: The Version's reconciliation status.
                type: string
              synced:
                description: A flag that determines whether the Version has been successfully
                  reconciled.
                type: boolean
            required:
            - checksum
            - syncStatus
            - synced
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
